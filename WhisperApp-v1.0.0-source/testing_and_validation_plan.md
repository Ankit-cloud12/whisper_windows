# WhisperApp - Testing and Validation Plan

This document outlines the manual testing plan for the WhisperApp application, focusing on recent enhancements and core functionality.

## 1. Prerequisites

Before starting testing, ensure the following are available:

-   **Compiled Application:** The latest build of `WhisperApp.exe` (and associated files) from the `feature/windows-enhancements-p1` branch or the relevant development branch containing all recent changes.
-   **Installer Package:** The NSIS installer package (`WhisperApp-Installer.exe` or similar) generated by CPack from the same branch.
-   **Target Windows Versions:** Testing should primarily be performed on:
    -   Windows 10 (version 1809 or newer).
    -   Windows 11 (latest available version).
-   **Hardware:**
    -   A functional microphone (internal or external).
    -   Optional: A High-DPI display (e.g., 150% or 200% scaling enabled in Windows display settings) to test UI scaling.
-   **Clean State (Recommended for some tests):**
    -   Consider uninstalling any previous versions of WhisperApp.
    -   Backup and remove/rename existing WhisperApp settings/log directories (usually in `%APPDATA%\WhisperApp` or `%LOCALAPPDATA%\WhisperApp`) for a clean first-run experience for some tests.

## 2. Installation and Uninstallation Testing

**Test Case 2.1: Run Installer**
-   **Action:**
    1.  Execute the `WhisperApp-Installer.exe`.
-   **Expected Results:**
    1.  A license agreement page appears, displaying the content of `LICENSE.txt`. The user must be able to accept the agreement to proceed.
    2.  An installation path selection page appears, pre-filled with a default path (e.g., `C:\Program Files\WhisperApp`). The user can browse and select a different installation path.
    3.  The installation process completes without errors.
    4.  A desktop shortcut for "WhisperApp" is created.
    5.  A Start Menu folder named "WhisperApp" is created, containing a shortcut named "WhisperApp" that points to the installed executable.

**Test Case 2.2: Run Application from Shortcuts**
-   **Action:**
    1.  Launch WhisperApp using the Start Menu shortcut. Close the application.
    2.  Launch WhisperApp using the Desktop shortcut. Close the application.
-   **Expected Results:**
    1.  The application starts successfully from both shortcuts.
    2.  The application functions normally when launched from shortcuts.

**Test Case 2.3: Uninstall Application**
-   **Action:**
    1.  Uninstall WhisperApp using "Add or remove programs" in Windows Settings, or via the uninstaller shortcut if one is created in the Start Menu folder.
-   **Expected Results:**
    1.  The uninstallation process completes without errors.
    2.  The Desktop shortcut for "WhisperApp" is removed.
    3.  The Start Menu shortcut "WhisperApp" is removed.
    4.  The Start Menu folder "WhisperApp" is removed (NSIS `RMDir` typically removes the folder only if it's empty; this is acceptable).
    5.  The main installation directory (e.g., `C:\Program Files\WhisperApp`) and its contents are removed. Files created by the application after installation (like user settings, logs, downloaded models) might remain by design, which is acceptable.

## 3. UI and Theming Tests

**Test Case 3.1: High-DPI Display Scaling (Conditional)**
-   **Action:**
    1.  If a high-DPI display is available, set Windows display scaling to 150% or 200%.
    2.  Run WhisperApp.
    3.  Observe various UI elements: main window, settings dialog, text in transcription widget, icons, buttons.
-   **Expected Results:**
    1.  All UI elements, text, and icons appear sharp, correctly sized, and are not blurry or pixelated.
    2.  Layouts adapt correctly without overlapping or truncated elements.

**Test Case 3.2: Focus Indicators**
-   **Action:**
    1.  Launch WhisperApp.
    2.  Test in each theme (Default, Light, Dark - switch via settings if available, or by modifying settings file manually if theme switching UI is not yet fully integrated).
    3.  In the main window and Settings Dialog:
        -   Use the `Tab` key to navigate between interactive UI elements (`QPushButton`, `QLineEdit`, `QComboBox`, `QSpinBox`, `QCheckBox`, etc.).
        -   Observe the element that currently has keyboard focus.
-   **Expected Results:**
    1.  A clear and visible focus indicator is present on the focused element.
    2.  For `QPushButton`: An outline (e.g., blue or theme-specific accent color) should appear around the button.
    3.  For `QLineEdit`, `QComboBox`, `QSpinBox`: A border (e.g., 2px solid in theme accent color) and/or a subtle glow/box-shadow should appear.
    4.  Focus indication is consistent across similar types of controls within each theme.
    5.  Focus indication is distinct and easily noticeable in all three themes.

## 4. Error Handling and User Feedback Tests

**Test Case 4.1: Tray Icon - Processing State**
-   **Action:**
    1.  Ensure a model is loaded and a microphone is connected.
    2.  Start a short recording (e.g., 2-3 seconds of speech).
    3.  Stop the recording. Observe the system tray icon and its tooltip immediately after stopping.
-   **Expected Results:**
    1.  The system tray icon changes to a "Processing" visual (e.g., a spinner icon ⏳ or a clockwise arrow).
    2.  The tooltip for the tray icon updates to "WhisperApp - Processing audio...".
    3.  After transcription completes, the tray icon and tooltip revert to "Idle" ("WhisperApp - Ready") or "Recording" if in a continuous mode.

**Test Case 4.2: Tray Icon & MainWindow - Error State (No Model)**
-   **Action:**
    1.  Ensure no model is selected in `MainWindow`'s model selection ComboBox. (If a model is auto-selected, try to clear settings or find a way to deselect, or temporarily rename the models directory so no models can be found).
    2.  Attempt to start recording.
-   **Expected Results:**
    1.  A warning/error message dialog appears in `MainWindow` indicating a model needs to be selected/is unavailable.
    2.  The `m_statusLabel` in `MainWindow` displays an error message (e.g., "Error: No model selected or available.") and its text color changes to red.
    3.  The record button (`m_recordButton`) in `MainWindow` becomes disabled.
    4.  The system tray icon changes to an "Error" visual.
    5.  The tooltip for the tray icon updates to indicate an error state (e.g., "WhisperApp - Error occurred. Check application." or "WhisperApp - Disabled (No valid model selected)").

**Test Case 4.3: Tray Icon & MainWindow - Disabled State (Simulated)**
-   **Action:**
    1.  This might be similar to 4.2 if "No model" leads to a disabled state.
    2.  If there's another way to simulate a non-functional state (e.g., if future checks disable the app if no microphone is found), trigger that. For now, the "No model" test largely covers this.
-   **Expected Results:**
    1.  The system tray icon changes to a "Disabled" visual (e.g., grayed-out version of the normal icon).
    2.  The tooltip for the tray icon updates (e.g., "WhisperApp - Disabled (No valid model selected)").
    3.  `MainWindow` `m_statusLabel` indicates the issue and is styled for error/warning.
    4.  `MainWindow` `m_recordButton` is disabled.

**Test Case 4.4: `ModelManager` Logging**
-   **Action:**
    1.  Start the application (ModelManager is initialized).
    2.  If the Model Manager UI is available, attempt to download a small model or refresh the model list.
    3.  Open the application's log file (location might be in AppData or configurable in advanced settings).
-   **Expected Results:**
    1.  Log messages from the "ModelManager" module are present.
    2.  These messages use the application's standard logging format (e.g., with timestamp, level, module name) rather than raw `std::cout` or `std::cerr` style output.
    3.  Errors during download (if simulated, e.g., by disconnecting internet) should be logged with `ERROR` level by the `ModelManager`.

**Test Case 4.5: `AudioCapture` Error Handling (Conceptual)**
-   **Action:**
    1.  Start recording.
    2.  If possible and safe, unplug the currently used microphone.
    3.  Alternatively, disable the microphone from system settings while recording is active.
-   **Expected Results:**
    1.  The application should handle this gracefully, not crash.
    2.  Ideally, recording stops, and an error message is displayed to the user (e.g., in `m_statusLabel` and/or as a tray notification).
    3.  The tray icon updates to an "Error" or "Disabled" state.
    4.  Error related to audio capture failure is logged. (Note: Specific `AudioException` throws were added for initialization; runtime errors might be handled differently, by stopping capture and signaling error).

## 5. New Feature Testing

**Test Case 5.1: "Always on Top" Feature**
-   **Action:**
    1.  Open WhisperApp. Observe its window behavior relative to other applications.
    2.  Go to Settings -> Appearance (or the relevant tab).
    3.  Check the "Always on Top" checkbox. Click "Apply" (if available) or "OK".
    4.  Interact with other application windows.
    5.  Uncheck the "Always on Top" checkbox in Settings. Click "Apply" (if available) or "OK".
    6.  Interact with other application windows.
    7.  Enable "Always on Top", close WhisperApp. Re-launch WhisperApp.
-   **Expected Results:**
    1.  Initially, the WhisperApp window behaves like a standard window.
    2.  When "Always on Top" is enabled, the WhisperApp main window remains on top of all other non-topmost windows.
    3.  When "Always on Top" is disabled, the WhisperApp main window returns to standard window behavior.
    4.  The setting persists across application restarts. If enabled and app is restarted, it should start as always on top.

**Test Case 5.2: "Start with Windows" Feature**
-   **Action:**
    1.  Open Settings -> General (or the relevant tab).
    2.  Check the "Start with Windows" checkbox. Click "Apply" (if available) or "OK".
    3.  Open Windows Registry Editor (`regedit`). Navigate to `HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run`.
    4.  Verify the "WhisperApp" entry.
    5.  Restart Windows.
    6.  After login, observe if WhisperApp starts automatically.
    7.  Open Settings -> General. Uncheck "Start with Windows". Click "Apply" (if available) or "OK".
    8.  Re-check the Windows Registry path.
    9.  Restart Windows.
-   **Expected Results:**
    1.  When "Start with Windows" is enabled, an entry for "WhisperApp" pointing to the correct application executable path is created in the specified Windows Registry key.
    2.  WhisperApp starts automatically after Windows reboots when the setting is enabled.
    3.  When "Start with Windows" is disabled, the "WhisperApp" registry entry is removed.
    4.  WhisperApp does not start automatically after Windows reboots when the setting is disabled.
    5.  Relevant messages regarding registry update success/failure are logged.

## 6. Core Functionality Regression Testing

**Test Case 6.1: Basic Recording & Transcription**
-   **Action:**
    1.  Ensure a valid model is selected and an audio device is available.
    2.  Click the "Start Recording" button.
    3.  Speak clearly into the microphone for a few seconds.
    4.  Click the "Stop Recording" button.
-   **Expected Results:**
    1.  During recording:
        -   `MainWindow` `m_statusLabel` shows "Recording...".
        -   Record button shows "Stop Recording".
        -   Tray icon shows "Recording" state (flashing icon, "Recording..." tooltip).
    2.  After stopping:
        -   `MainWindow` `m_statusLabel` shows "Processing...".
        -   `m_processingSpinner` becomes visible.
        -   Tray icon shows "Processing" state.
    3.  After processing:
        -   The spoken words appear as text in the `TranscriptionWidget`.
        -   `MainWindow` `m_statusLabel` shows "Transcription complete" or "Ready".
        -   `m_processingSpinner` is hidden.
        -   Tray icon returns to "Idle" state.

**Test Case 6.2: `TranscriptionWidget` Context Menu**
-   **Action:**
    1.  Type some text into the `TranscriptionWidget` (e.g., "Hello world. Test.").
    2.  Select a portion of the text (e.g., "world").
    3.  Right-click on the selected text.
    4.  Test "Copy", then deselect and "Paste" in a new location.
    5.  Test "Cut".
    6.  Test "Undo" and "Redo".
    7.  Test "Select All".
-   **Expected Results:**
    1.  The custom context menu appears.
    2.  It contains actions for Undo, Redo, Cut, Copy, Paste, Select All, Find, Insert Timestamp.
    3.  "Copy" and "Cut" are enabled when text is selected. "Paste" is enabled if the clipboard has text. "Undo"/"Redo" are enabled if actions are available in the stack.
    4.  All tested standard editing actions (Copy, Paste, Cut, Undo, Redo, Select All) function correctly on the text in `TranscriptionWidget`.

**Test Case 6.3: Settings Dialog Persistence**
-   **Action:**
    1.  Open Settings. Change a simple, easily verifiable setting (e.g., UI Theme, or if a "Show Timestamps" checkbox exists in settings for `TranscriptionWidget`).
    2.  Click "Apply" (if enabled), then "OK" or just "OK".
    3.  Close WhisperApp.
    4.  Re-launch WhisperApp and re-open Settings.
-   **Expected Results:**
    1.  The changed setting should persist and be correctly loaded when the dialog is re-opened and when the application restarts.
    2.  The application behavior should reflect the changed setting.

**Test Case 6.4: Transcription History**
-   **Action:**
    1.  Perform 2-3 unique transcriptions.
    2.  Open the Transcription History window/dock.
    3.  Select one entry.
    4.  Select another entry.
    5.  Select one entry and click "Delete Selected". Confirm deletion.
-   **Expected Results:**
    1.  All transcriptions appear as entries in the history list.
    2.  Selecting an entry updates the preview pane with its details and text.
    3.  The selected entry is successfully deleted after confirmation.
    4.  The history list updates accordingly.

## 7. Reporting

-   For each test case, clearly note: **Pass** or **Fail**.
-   If **Fail**, provide the following details:
    -   Windows Version (e.g., Windows 10 Pro 22H2, Windows 11 Home 23H2).
    -   Specific steps taken to reproduce the failure.
    -   Actual Result: What happened.
    -   Expected Result: What should have happened.
    -   Attach screenshots or log snippets if helpful.
-   Note any crashes, freezes, or other unexpected application behavior, along with steps to reproduce if known.
-   Provide feedback on usability or areas of confusion if any.
